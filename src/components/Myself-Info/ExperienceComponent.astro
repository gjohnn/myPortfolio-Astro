---
import experiences from '../../data/experiences';

// Summary stats
const totalExperiences = experiences.length;
const allTechs = [...new Set(experiences.flatMap(e => e.technologies))];
const totalTechs = allTechs.length;
---

<!-- Summary Stats -->
<!-- <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-10">
  <div class="card p-4 text-center" style="border-color: var(--comic-red);">
    <div class="text-3xl mb-1" style="font-family: var(--font-comic); color: var(--comic-red);">{totalExperiences}</div>
    <div class="text-xs" style="font-family: var(--font-accent); color: var(--gray-600); letter-spacing: 1px;">POSITIONS</div>
  </div>
  <div class="card p-4 text-center" style="border-color: var(--comic-blue);">
    <div class="text-3xl mb-1" style="font-family: var(--font-comic); color: var(--comic-blue);">{totalTechs}</div>
    <div class="text-xs" style="font-family: var(--font-accent); color: var(--gray-600); letter-spacing: 1px;">TECHNOLOGIES</div>
  </div>
  <div class="card p-4 text-center col-span-2 sm:col-span-1" style="border-color: var(--comic-green);">
    <div class="text-3xl mb-1" style="font-family: var(--font-comic); color: var(--comic-green);">+2</div>
    <div class="text-xs" style="font-family: var(--font-accent); color: var(--gray-600); letter-spacing: 1px;">YEARS EXP</div>
  </div>
</div> -->

<!-- Timeline -->
<div class="relative">
  <!-- Center Line (desktop) -->
  <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-1 -translate-x-1/2" 
       style="background: var(--comic-black); border-radius: 2px;"></div>
  
  <!-- Mobile Line -->
  <div class="md:hidden absolute left-6 top-0 bottom-0 w-1" 
       style="background: var(--comic-black); border-radius: 2px;"></div>

  {experiences.map((exp, index) => {
    const isEven = index % 2 === 0;
    const colors = [
      'var(--comic-red)', 'var(--comic-blue)', 'var(--comic-orange)', 
      'var(--comic-green)', 'var(--comic-purple)'
    ];
    const color = colors[index % colors.length];
    
    return (
      <div class={`relative mb-8 md:mb-12 md:flex ${isEven ? 'md:flex-row' : 'md:flex-row-reverse'}`}>
        <!-- Timeline Dot -->
        <div class="absolute left-6 md:left-1/2 -translate-x-1/2 w-5 h-5 rounded-full z-10"
             style={`background: ${color}; border: 3px solid var(--comic-black); box-shadow: 2px 2px 0 var(--comic-black); top: 1.5rem;`}>
        </div>

        <!-- Spacer -->
        <div class="hidden md:block md:w-1/2"></div>

        <!-- Card -->
        <div class={`ml-14 md:ml-0 md:w-1/2 ${isEven ? 'md:pl-8' : 'md:pr-8'}`}>
          <article class="card p-5 sm:p-6 experience-card animate-on-scroll" style={`border-top: 4px solid ${color};`}>
            <!-- Header -->
            <div class="flex items-start justify-between mb-3">
              <div class="flex-1">
                <h3 class="text-lg sm:text-xl" style={`font-family: var(--font-comic); color: ${color}; letter-spacing: 1px;`}>
                  {exp.role}
                </h3>
                <div class="flex items-center gap-2 mt-1">
                  {exp.companyUrl ? (
                    <a href={exp.companyUrl} target="_blank" rel="noopener noreferrer" 
                       class="text-sm hover:underline" 
                       style={`font-family: var(--font-body); color: ${color}; font-weight: 800;`}>
                      {exp.company} <i class="fas fa-external-link-alt text-xs"></i>
                    </a>
                  ) : (
                    <span class="text-sm" style={`font-family: var(--font-body); color: ${color}; font-weight: 800;`}>{exp.company}</span>
                  )}
                </div>
                {exp.project && (
                  <div class="mt-1">
                    {exp.projectUrl ? (
                      <a href={exp.projectUrl} target="_blank" rel="noopener noreferrer" 
                         class="text-xs hover:underline" style="font-family: var(--font-accent); color: var(--gray-500);">
                        {exp.project} <i class="fas fa-external-link-alt text-xs"></i>
                      </a>
                    ) : (
                      <span class="text-xs" style="font-family: var(--font-accent); color: var(--gray-500);">{exp.project}</span>
                    )}
                  </div>
                )}
              </div>
              <span class="text-xs px-3 py-1 rounded flex-shrink-0 ml-2"
                    style={`background: var(--comic-cream); border: 2px solid var(--comic-black); font-family: var(--font-accent); color: var(--comic-black); letter-spacing: 0.5px;`}>
                {exp.period}
              </span>
            </div>

            <!-- Technologies -->
            <div class="flex flex-wrap gap-1.5 mb-4">
              {exp.technologies.map(tech => (
                <span class="tech-badge text-xs">{tech}</span>
              ))}
            </div>

            <!-- Responsibilities (collapsible) -->
            <details class="exp-details">
              <summary class="cursor-pointer text-sm flex items-center gap-2 select-none"
                       style={`font-family: var(--font-accent); color: ${color}; letter-spacing: 0.5px;`}>
                <i class="fas fa-chevron-right text-xs exp-chevron transition-transform"></i>
                RESPONSIBILITIES ({exp.responsibilities.length})
              </summary>
              <div class="mt-3 space-y-2 pl-2" style="border-left: 3px solid var(--comic-cream);">
                {exp.responsibilities.map(resp => (
                  <div class="flex items-start gap-2 text-sm">
                    <i class="fas fa-bolt text-xs mt-1 flex-shrink-0" style="color: var(--comic-yellow-dark);"></i>
                    <span style="font-family: var(--font-body); color: var(--gray-700); font-weight: 700;">{resp}</span>
                  </div>
                ))}
              </div>
            </details>
          </article>
        </div>
      </div>
    );
  })}
</div>

<style>
  .exp-details[open] .exp-chevron {
    transform: rotate(90deg);
  }
  .experience-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .experience-card:hover {
    transform: translateY(-2px);
    box-shadow: 6px 6px 0 var(--comic-black);
  }
</style>